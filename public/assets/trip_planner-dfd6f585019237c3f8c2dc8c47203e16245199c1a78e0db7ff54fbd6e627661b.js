$(function(){function e(){var e=new google.maps.DirectionsService,o=new google.maps.DirectionsRenderer;map=new google.maps.Map(document.getElementById("map-trip-planner"),{zoom:7}),o.setMap(map),o.setPanel(document.getElementById("right-panel")),t(e,o,map)}function t(e,t,n){var a=$("#trip_id").val();$.ajax({url:"/trips/"+a+"/fetch_posts"}).done(function(a){for(var i=a.posts,r=a.trip,s=r.start,l=r.end,p=[],m=0;m<i.length;m++)p.push({location:i[m].address1,stopover:!0}),p.push({location:i[m].address2,stopover:!0});e.route({origin:s,destination:l,waypoints:p,optimizeWaypoints:!0,travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC},function(e,a){if("OK"===a){t.setDirections(e);for(var i=[],r=0;r<e.routes[0].legs.length;r++){i[r]=new google.maps.InfoWindow;var s=e.routes[0].legs[r],l=google.maps.geometry.spherical.interpolate(s.start_location,s.end_location,.5);o(n,l,"label","html")}}else window.alert("Directions request failed due to "+a)})})}function o(e,t,o,n){var a="<b>"+o+"</b><br>"+n,i=new google.maps.Marker({position:t,map:e,title:o,zIndex:Math.round(t.lat()*-1e5)<<5});return i.myname=o,google.maps.event.addListener(i,"click",function(){infowindow.setContent(a+"<br>"+i.getPosition().toUrlValue(6)),infowindow.open(e,i)}),i}function n(e,t){map.setCenter({lat:e,lng:t}),map.setZoom(9)}$(".trip-planner-sidebar-item").on("click",function(){var e=$(this).data("lat"),t=$(this).data("lng");n(e,t)}),e()});